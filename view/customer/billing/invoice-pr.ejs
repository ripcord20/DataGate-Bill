<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tagihan <%= invoice.invoice_number %> - <%= appSettings.companyHeader %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            body { margin: 0; padding: 10px; }
            .card { border: 1px solid #ddd; box-shadow: none; }
            .container { max-width: 100%; }
            .row { margin: 0; }
            .col-md-6, .col-md-4 { padding: 0 5px; }
        }
        
        body { 
            background: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            line-height: 1.3;
            margin: 0;
            padding: 10px;
        }
        
        .container {
            max-width: 210mm;
            margin: 0 auto;
            padding: 0;
        }
        
        .invoice-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .company-logo {
            max-width: 80px;
            max-height: 40px;
        }
        
        .invoice-details {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 11px;
        }
        
        .amount-box {
            background: #28a745;
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .table {
            font-size: 11px;
            margin-bottom: 10px;
        }
        
        .table th {
            background: #f8f9fa;
            border-top: 2px solid #dee2e6;
            padding: 8px 4px;
            font-size: 11px;
        }
        
        .table td {
            padding: 6px 4px;
            font-size: 11px;
        }
        
        .card {
            margin-bottom: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .card-header {
            padding: 8px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            font-size: 12px;
            font-weight: bold;
        }
        
        .card-body {
            padding: 10px;
        }
        
        .footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px solid #dee2e6;
            text-align: center;
            color: #6c757d;
            font-size: 10px;
        }
        
        .status-badge {
            font-size: 10px;
            padding: 4px 8px;
        }
        
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .row {
            margin: 0 -5px;
        }
        
        .col-md-6, .col-md-4 {
            padding: 0 5px;
        }
        
        h2 { font-size: 18px; margin: 0; }
        h3 { font-size: 16px; margin: 0; }
        h4 { font-size: 14px; margin: 0; }
        h5 { font-size: 12px; margin: 0; }
        h6 { font-size: 11px; margin: 0; }
        
        .badge {
            font-size: 10px;
            padding: 3px 6px;
        }
        
        .text-center { text-align: center; }
        .text-end { text-align: right; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 5px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 10px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 10px; }
        .me-2 { margin-right: 8px; }
        .me-3 { margin-right: 10px; }
        .ms-2 { margin-left: 8px; }
        
        .small { font-size: 10px; }
        
        .table-borderless td {
            padding: 2px 4px;
            font-size: 11px;
        }
        
        .table-bordered {
            border: 1px solid #dee2e6;
        }
        
        .table-bordered th,
        .table-bordered td {
            border: 1px solid #dee2e6;
            padding: 4px;
            font-size: 10px;
        }
        
        .text-muted { color: #6c757d; }
        .text-danger { color: #dc3545; }
        .text-success { color: #28a745; }
        .text-primary { color: #007bff; }
        .text-warning { color: #ffc107; }
        .text-info { color: #17a2b8; }
        
        .bg-success { background-color: #28a745; }
        .bg-primary { background-color: #007bff; }
        .bg-info { background-color: #17a2b8; }
        .bg-warning { background-color: #ffc107; }
        .bg-danger { background-color: #dc3545; }
        .bg-secondary { background-color: #6c757d; }
        
        .d-flex { display: flex; }
        .align-items-center { align-items: center; }
        .justify-content-between { justify-content: space-between; }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        @media print {
            @page {
                size: A4;
                margin: 10mm;
            }
            
            body {
                font-size: 10px;
                line-height: 1.2;
            }
            
            .invoice-header {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .invoice-details {
                padding: 8px;
                margin-bottom: 8px;
            }
            
            .card {
                margin-bottom: 8px;
            }
            
            .card-header {
                padding: 6px 10px;
            }
            
            .card-body {
                padding: 8px;
            }
            
            .table th,
            .table td {
                padding: 4px 2px;
                font-size: 9px;
            }
            
            .footer {
                margin-top: 10px;
                padding-top: 8px;
                font-size: 9px;
            }
        }
    </style>
</head>
<body>
    <!-- Print Button -->
    <div class="print-button no-print">
        <button onclick="window.print()" class="btn btn-primary">
            <i class="bi bi-printer"></i> Print
        </button>
        <a href="/customer/billing/invoices/<%= invoice.id %>" class="btn btn-secondary ms-2">
            <i class="bi bi-arrow-left"></i> Kembali
        </a>
    </div>

         <div class="container">
         <!-- Invoice Header -->
         <div class="invoice-header">
             <div class="row align-items-center">
                 <div class="col-md-8">
                     <div class="d-flex align-items-center mb-2">
                         <img src="/img/<%= appSettings.logoFilename %>" alt="Logo" class="company-logo me-2">
                         <div>
                             <h2 class="mb-0"><%= appSettings.companyHeader %></h2>
                             <small class="mb-0"><%= appSettings.footerInfo %></small>
                         </div>
                     </div>
                     <h3 class="mb-1">TAGIHAN #<%= invoice.invoice_number %></h3>
                     <p class="mb-0">
                         <strong>Status:</strong>
                         <% if (invoice.status === 'paid') { %>
                             <span class="badge bg-success status-badge">LUNAS</span>
                         <% } else if (invoice.status === 'unpaid') { %>
                             <% if (new Date(invoice.due_date) < new Date()) { %>
                                 <span class="badge bg-danger status-badge">TERLAMBAT</span>
                             <% } else { %>
                                 <span class="badge bg-warning status-badge">BELUM LUNAS</span>
                             <% } %>
                         <% } %>
                     </p>
                 </div>
                 <div class="col-md-4 text-end">
                     <div class="amount-box">
                         <h4 class="mb-0">Total Tagihan</h4>
                         <h2 class="mb-0">Rp <%= parseFloat(invoice.amount).toLocaleString('id-ID') %></h2>
                     </div>
                 </div>
             </div>
         </div>

                 <!-- Customer & Invoice Info -->
         <div class="row">
             <div class="col-md-6">
                 <div class="invoice-details">
                     <h5 class="mb-2">
                         <i class="bi bi-person"></i> Informasi Pelanggan
                     </h5>
                     <table class="table table-borderless">
                         <tr>
                             <td><strong>Nama:</strong></td>
                             <td><%= invoice.customer_name %></td>
                         </tr>
                         <tr>
                             <td><strong>Username:</strong></td>
                             <td><%= invoice.username %></td>
                         </tr>
                         <tr>
                             <td><strong>Telepon:</strong></td>
                             <td><%= invoice.customer_phone || '-' %></td>
                         </tr>
                     </table>
                 </div>
             </div>
             <div class="col-md-6">
                 <div class="invoice-details">
                     <h5 class="mb-2">
                         <i class="bi bi-receipt"></i> Informasi Tagihan
                     </h5>
                     <table class="table table-borderless">
                         <tr>
                             <td><strong>No. Tagihan:</strong></td>
                             <td><%= invoice.invoice_number %></td>
                         </tr>
                         <tr>
                             <td><strong>Tanggal Dibuat:</strong></td>
                             <td><%= new Date(invoice.created_at).toLocaleDateString('id-ID') %></td>
                         </tr>
                         <tr>
                             <td><strong>Jatuh Tempo:</strong></td>
                             <td>
                                 <% if (new Date(invoice.due_date) < new Date() && invoice.status === 'unpaid') { %>
                                     <span class="text-danger">
                                         <%= new Date(invoice.due_date).toLocaleDateString('id-ID') %>
                                     </span>
                                 <% } else { %>
                                     <%= new Date(invoice.due_date).toLocaleDateString('id-ID') %>
                                 <% } %>
                             </td>
                         </tr>
                         <% if (invoice.payment_date) { %>
                             <tr>
                                 <td><strong>Tanggal Bayar:</strong></td>
                                 <td><%= new Date(invoice.payment_date).toLocaleDateString('id-ID') %></td>
                             </tr>
                         <% } %>
                     </table>
                 </div>
             </div>
         </div>

                 <!-- Package Details -->
         <div class="card mb-3">
             <div class="card-header">
                 <h5 class="mb-0">
                     <i class="bi bi-package"></i> Detail Paket
                 </h5>
             </div>
             <div class="card-body">
                 <div class="table-responsive">
                     <table class="table table-bordered">
                         <thead>
                             <tr>
                                 <th>Deskripsi</th>
                                 <th>Kecepatan</th>
                                 <th class="text-end">Harga</th>
                             </tr>
                         </thead>
                         <tbody>
                             <tr>
                                 <td><strong><%= invoice.package_name %></strong></td>
                                 <td><%= invoice.package_speed %></td>
                                 <td class="text-end">Rp <%= parseFloat(invoice.amount).toLocaleString('id-ID') %></td>
                             </tr>
                         </tbody>
                         <tfoot>
                             <tr>
                                 <td colspan="2" class="text-end"><strong>Total:</strong></td>
                                 <td class="text-end"><strong>Rp <%= parseFloat(invoice.amount).toLocaleString('id-ID') %></strong></td>
                             </tr>
                         </tfoot>
                     </table>
                 </div>
             </div>
         </div>

                 <!-- Payment History -->
         <% if (payments && payments.length > 0) { %>
             <div class="card mb-3">
                 <div class="card-header">
                     <h5 class="mb-0">
                         <i class="bi bi-cash-stack"></i> Riwayat Pembayaran
                     </h5>
                 </div>
                 <div class="card-body">
                     <div class="table-responsive">
                         <table class="table table-bordered">
                             <thead>
                                 <tr>
                                     <th>Tanggal</th>
                                     <th>Jumlah</th>
                                     <th>Metode</th>
                                     <th>Referensi</th>
                                     <th>Catatan</th>
                                 </tr>
                             </thead>
                             <tbody>
                                 <% payments.forEach(function(payment) { %>
                                     <tr>
                                         <td><%= new Date(payment.payment_date).toLocaleDateString('id-ID') %></td>
                                         <td>Rp <%= parseFloat(payment.amount).toLocaleString('id-ID') %></td>
                                         <td>
                                             <% if (payment.payment_method === 'cash') { %>
                                                 <span class="badge bg-success">Tunai</span>
                                             <% } else if (payment.payment_method === 'transfer') { %>
                                                 <span class="badge bg-primary">Transfer</span>
                                             <% } else if (payment.payment_method === 'qris') { %>
                                                 <span class="badge bg-info">QRIS</span>
                                             <% } else if (payment.payment_method === 'ewallet') { %>
                                                 <span class="badge bg-warning">E-Wallet</span>
                                             <% } else { %>
                                                 <span class="badge bg-secondary"><%= payment.payment_method %></span>
                                             <% } %>
                                         </td>
                                         <td><%= payment.reference_number || '-' %></td>
                                         <td><%= payment.notes || '-' %></td>
                                     </tr>
                                 <% }); %>
                             </tbody>
                         </table>
                     </div>
                 </div>
             </div>
         <% } %>
 
         <!-- Notes -->
         <% if (invoice.notes) { %>
             <div class="card mb-3">
                 <div class="card-header">
                     <h5 class="mb-0">
                         <i class="bi bi-chat-text"></i> Catatan
                     </h5>
                 </div>
                 <div class="card-body">
                     <p class="mb-0"><%= invoice.notes %></p>
                 </div>
             </div>
         <% } %>

                 <!-- Payment Instructions -->
         <% if (invoice.status === 'unpaid') { %>
             <div class="card mb-3">
                 <div class="card-header bg-warning text-dark">
                     <h5 class="mb-0">
                         <i class="bi bi-exclamation-triangle"></i> Instruksi Pembayaran
                     </h5>
                 </div>
                 <div class="card-body">
                     <p class="mb-2">Silakan lakukan pembayaran melalui salah satu metode berikut:</p>
                     <div class="row">
                         <div class="col-md-4">
                             <div class="text-center">
                                 <i class="bi bi-cash text-success" style="font-size: 1.5rem;"></i>
                                 <h6 class="mt-1 mb-1">Tunai</h6>
                                 <p class="small mb-0">
                                     <%= settings.payment_cash_address || 'Kantor kami' %><br>
                                     <% if (settings.payment_cash_hours) { %>
                                         Jam: <%= settings.payment_cash_hours %>
                                     <% } %>
                                 </p>
                             </div>
                         </div>
                         <div class="col-md-4">
                             <div class="text-center">
                                 <i class="bi bi-bank text-primary" style="font-size: 1.5rem;"></i>
                                 <h6 class="mt-1 mb-1">Transfer Bank</h6>
                                 <p class="small mb-0">
                                     <%= settings.payment_bank_name || 'Bank' %><br>
                                     No. Rek: <%= settings.payment_account_number || '1234567890' %><br>
                                     A/N: <%= settings.payment_account_holder || 'ALIJAYA DIGITAL NETWORK' %>
                                 </p>
                             </div>
                         </div>
                         <div class="col-md-4">
                             <div class="text-center">
                                 <i class="bi bi-qr-code text-info" style="font-size: 1.5rem;"></i>
                                 <h6 class="mt-1 mb-1">QRIS</h6>
                                 <p class="small mb-0">Scan QR Code untuk pembayaran</p>
                             </div>
                         </div>
                     </div>
                     <p class="text-muted small mt-2 mb-0">
                         <strong>Catatan:</strong> Hubungi admin untuk informasi pembayaran lebih lanjut.<br>
                         <i class="bi bi-telephone"></i> <%= appSettings.contact_phone || '0812-3456-7890' %> | 
                         <i class="bi bi-whatsapp"></i> <%= appSettings.contact_whatsapp || '081947215703' %>
                     </p>
                 </div>
             </div>
         <% } %>

                 <!-- Footer -->
         <div class="footer">
             <p class="mb-1">
                 <strong><%= appSettings.companyHeader %></strong><br>
                 <%= appSettings.footerInfo %>
             </p>
             <p class="small text-muted mb-0">
                 Tagihan ini dibuat secara otomatis oleh sistem billing.<br>
                 Cetak tanggal: <%= new Date().toLocaleDateString('id-ID') %> <%= new Date().toLocaleTimeString('id-ID') %>
             </p>
             <% if (appSettings.contact_phone || appSettings.contact_email || appSettings.contact_address) { %>
             <p class="small text-muted mb-0 mt-1">
                 <i class="bi bi-telephone"></i> <%= appSettings.contact_phone || '' %> | 
                 <i class="bi bi-envelope"></i> <%= appSettings.contact_email || '' %> | 
                 <i class="bi bi-geo-alt"></i> <%= appSettings.contact_address || '' %>
             </p>
             <% } %>
         </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto print when page loads
        window.onload = function() {
            // Uncomment the line below to auto-print
            // window.print();
        };
    </script>
</body>
</html> 
